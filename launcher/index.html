<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›°ï¸ Starlight Mission Control</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header class="hero-header">
            <h1>ğŸ›°ï¸ Starlight Mission Control</h1>
            <p>Starlight Protocol v3.0.3 â€” Autonomous Browser Automation</p>
        </header>

        <!-- Control Bar -->
        <section class="mission-control" style="padding: 1.5rem 2rem; margin-bottom: 2rem;">
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <button class="btn btn-start" id="start-btn" onclick="handleStartAll()" style="min-width: 200px;">
                    â–¶ï¸ Start Hub + Sentinels
                </button>
                <button class="btn btn-stop" id="stop-btn" onclick="handleStopAll()"
                    style="display: none; min-width: 200px;">
                    â¹ï¸ Stop All
                </button>

                <div
                    style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--bg-primary); border-radius: 20px; border: 1px solid var(--border);">
                    <span id="system-dot"
                        style="width: 10px; height: 10px; border-radius: 50%; background: #666;"></span>
                    <span id="system-status-text" style="font-size: 14px;">Not Running</span>
                </div>

                <div style="flex: 1;"></div>

                <!-- Browser Selection -->
                <select id="browser-select"
                    style="padding: 8px 12px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: white;">
                    <option value="chromium">ğŸŒ Chromium</option>
                    <option value="firefox">ğŸ¦Š Firefox</option>
                    <option value="webkit">ğŸ§­ WebKit</option>
                </select>

                <!-- Mobile Emulation -->
                <select id="device-select"
                    style="padding: 8px 12px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: white;">
                    <option value="">ğŸ–¥ï¸ Desktop</option>
                    <optgroup label="iPhone">
                        <option value="iPhone 14">ğŸ“± iPhone 14</option>
                        <option value="iPhone 14 Pro Max">ğŸ“± iPhone 14 Pro Max</option>
                        <option value="iPhone 13">ğŸ“± iPhone 13</option>
                        <option value="iPhone SE">ğŸ“± iPhone SE</option>
                    </optgroup>
                    <optgroup label="Android">
                        <option value="Pixel 7">ğŸ“± Pixel 7</option>
                        <option value="Pixel 5">ğŸ“± Pixel 5</option>
                        <option value="Galaxy S9+">ğŸ“± Galaxy S9+</option>
                    </optgroup>
                    <optgroup label="Tablet">
                        <option value="iPad Pro 11">ğŸ“± iPad Pro 11</option>
                        <option value="iPad Mini">ğŸ“± iPad Mini</option>
                    </optgroup>
                </select>

                <!-- Network -->
                <select id="network-select"
                    style="padding: 8px 12px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: white;">
                    <option value="online">ğŸŒ Online</option>
                    <option value="4g">ğŸ“¶ 4G</option>
                    <option value="3g">ğŸ“¶ 3G</option>
                    <option value="offline">ğŸ“´ Offline</option>
                </select>

                <button class="btn btn-secondary" onclick="openReport()">ğŸ“Š Report</button>
            </div>
        </section>

        <!-- Fleet Status Grid -->
        <section class="status-grid" id="fleet-grid">
            <!-- Hub Card -->
            <div class="status-card" id="hub-card">
                <div class="status-header">
                    <span class="status-icon" id="hub-status">âš«</span>
                    <h3>ğŸ”µ CBA Hub</h3>
                </div>
                <p class="status-desc">Orchestrator & Browser Control</p>
                <button class="btn btn-start" id="hub-btn" onclick="toggleProcess('hub')">Launch Hub</button>
            </div>
            <!-- Dynamic Sentinels loaded by client.js -->

            <!-- Create New Sentinel Card -->
            <a href="/sentinel-editor" class="status-card"
                style="text-decoration: none; display: flex; flex-direction: column; justify-content: center; align-items: center; border-style: dashed; opacity: 0.7;">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">â•</div>
                <h3 style="color: var(--text-secondary);">Create Sentinel</h3>
                <p class="status-desc">Build with Visual Editor</p>
            </a>
        </section>

        <!-- Vitals Grid -->
        <section class="vitals-grid">
            <div class="vital-card">
                <div class="vital-label">Success Rate</div>
                <div class="vital-value" id="success-rate">0%</div>
                <div class="vital-trend">Real-time Mission Health</div>
            </div>
            <div class="vital-card">
                <div class="vital-label">Saved Effort</div>
                <div class="vital-value" id="saved-effort">0<span class="unit">min</span></div>
                <div class="vital-trend">Manual Triage Avoided</div>
            </div>
            <div class="vital-card">
                <div class="vital-label">Sovereign MTTR</div>
                <div class="vital-value" id="sovereign-mttr">0<span class="unit">ms</span></div>
                <div class="vital-trend">Mean Time to Recovery</div>
            </div>
            <div class="vital-card">
                <div class="vital-label">Interventions</div>
                <div class="vital-value" id="interventions-count">0</div>
                <div class="vital-trend">Autonomous Corrections</div>
            </div>
        </section>

        <!-- Mission Control -->
        <section class="mission-control">
            <h2>ğŸ¯ Mission Control</h2>
            <div class="mission-row">
                <select id="mission-select">
                    <option value="">-- Select a test script --</option>
                    <option value="test/intent.js">Basic Intent Test</option>
                    <option value="test/intent_saucedemo.js">SauceDemo E2E</option>
                    <option value="test/intent_shadow.js">Shadow DOM Test</option>
                    <option value="test/intent_nli_test.js">NLI Integration Test</option>
                    <option value="test/intent_learning.js">Learning Demo</option>
                    <option value="test/intent_portfolio.js">Portfolio Demo</option>
                    <option value="test/intent_portfolio_v2.js">Portfolio v2 (Event-Driven)</option>
                </select>
                <button class="btn btn-launch" id="launch-btn" onclick="launchMission()">ğŸš€ Launch Mission</button>
            </div>

            <div class="quick-actions">
                <input type="text" id="record-url" placeholder="https://example.com"
                    style="flex: 1; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-primary); color: white;">
                <button class="btn btn-secondary" id="record-btn" onclick="toggleRecording()">ğŸ”´ Record</button>
                <a href="/sentinel-editor" class="btn btn-secondary" style="text-decoration: none;">ğŸ› ï¸ Create
                    Sentinel</a>
                <button class="btn btn-secondary" onclick="clearLogs()">ğŸ—‘ï¸ Clear Logs</button>
            </div>
            <div id="recording-indicator"
                style="display:none; color: var(--accent-red); font-weight:bold; margin-top:10px;">
                âºï¸ Recording in progress... Click ğŸ”´ to stop
            </div>
        </section>

        <!-- Natural Language Intent -->
        <section class="mission-control" style="border-color: var(--accent-emerald);">
            <h2>ğŸ—£ï¸ Natural Language Command</h2>
            <div style="margin-bottom: 15px;">
                <textarea id="nli-input" placeholder="Type automation commands in plain English. Examples:

â€¢ Go to saucedemo.com
â€¢ Fill Username with standard_user
â€¢ Fill Password with secret_sauce
â€¢ Click the Login button
â€¢ Take a screenshot called homepage
â€¢ Scroll to bottom of the page"
                    style="width: 100%; min-height: 140px; padding: 15px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 12px; color: white; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            <div class="quick-actions" style="margin-bottom: 15px;">
                <select id="nli-provider"
                    style="padding: 8px 12px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: white;">
                    <option value="ollama">ğŸ¦™ Ollama (Local)</option>
                    <option value="openai">ğŸ¤– OpenAI API</option>
                    <option value="anthropic">ğŸ§  Anthropic API</option>
                </select>
                <select id="nli-model"
                    style="padding: 8px 12px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: white;">
                    <option value="llama3.2:1b">llama3.2:1b (Fast)</option>
                    <option value="llama3.2:3b">llama3.2:3b</option>
                    <option value="mistral">mistral</option>
                    <option value="codellama">codellama</option>
                </select>
                <button class="btn btn-secondary" onclick="loadNLIExample('login')">ğŸ“ Login Example</button>
                <button class="btn btn-secondary" onclick="loadNLIExample('checkout')">ğŸ“ Checkout Example</button>
                <button class="btn btn-secondary" onclick="checkNLIStatus()">ğŸ” NLI Status</button>
                <button class="btn btn-start" id="ollama-btn" onclick="toggleOllama()">ğŸ¦™ Launch Ollama</button>
            </div>
            <button class="btn btn-launch" style="width: 100%;" id="nli-btn" onclick="executeNLI()">
                ğŸš€ Execute Natural Language Command
            </button>
        </section>

        <!-- Log Console -->
        <section class="log-console">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">ğŸ“‹ Live Logs</h2>
                <button class="btn btn-secondary" onclick="clearLogs()" style="padding: 6px 12px;">Clear</button>
            </div>
            <div class="log-output" id="log-output">
                <div class="log-entry log-info">[System] Starlight Mission Control ready.</div>
                <div class="log-entry log-info">[System] Click "Start Hub + Sentinels" to begin.</div>
            </div>
        </section>

        <footer class="footer">
            <p>Starlight Protocol v3.0.3 â€” Built by <a href="https://www.dhirajdas.dev" target="_blank">Dhiraj Das</a>
            </p>
        </footer>
    </div>

    <script src="client.js"></script>
    <script>
        // Toast notification
        function showToast(message, isError = false) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; bottom: 20px; right: 20px; padding: 15px 25px;
                background: ${isError ? 'var(--accent-red)' : 'var(--accent-emerald)'};
                color: ${isError ? 'white' : 'var(--bg-primary)'};
                border-radius: 10px; font-weight: 600; z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function handleStartAll() {
            startAll();
            showToast('ğŸš€ Starting Hub and Sentinels...');
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'inline-flex';
            document.getElementById('system-dot').style.background = 'var(--accent-emerald)';
            document.getElementById('system-dot').style.boxShadow = '0 0 10px var(--accent-emerald)';
            document.getElementById('system-status-text').textContent = 'Starting...';
            setTimeout(() => {
                document.getElementById('system-status-text').textContent = 'Running';
            }, 2000);
        }

        function handleStopAll() {
            stopAll();
            showToast('â¹ï¸ Stopping all processes...');
            document.getElementById('start-btn').style.display = 'inline-flex';
            document.getElementById('stop-btn').style.display = 'none';
            document.getElementById('system-dot').style.background = '#666';
            document.getElementById('system-dot').style.boxShadow = 'none';
            document.getElementById('system-status-text').textContent = 'Not Running';
        }

        function executeNLI() {
            const input = document.getElementById('nli-input').value.trim();
            if (!input) {
                showToast('Please enter a command', true);
                return;
            }
            showToast('ğŸ—£ï¸ Executing command...');
            if (typeof window.executeNL === 'function') {
                window.executeNL(input);
            } else {
                addLog('[NLI] ' + input, 'info');
            }
        }
    </script>
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</body>

</html>