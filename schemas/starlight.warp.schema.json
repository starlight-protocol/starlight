{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://starlight-protocol.github.io/schemas/starlight.warp.schema.json",
    "title": "Starlight Warp File",
    "description": "Serialized browser context for failure triage - Phase 17",
    "type": "object",
    "properties": {
        "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Warp file format version"
        },
        "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Capture timestamp"
        },
        "reason": {
            "type": "string",
            "description": "Why the warp was captured (e.g., mission_failure, manual)"
        },
        "url": {
            "type": "string",
            "description": "Page URL at capture time"
        },
        "storage": {
            "type": "object",
            "properties": {
                "local": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "session": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                }
            }
        },
        "cookies": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "value": {
                        "type": "string"
                    },
                    "domain": {
                        "type": "string"
                    },
                    "path": {
                        "type": "string"
                    },
                    "expires": {
                        "type": "number"
                    },
                    "httpOnly": {
                        "type": "boolean"
                    },
                    "secure": {
                        "type": "boolean"
                    },
                    "sameSite": {
                        "type": "string"
                    }
                },
                "required": [
                    "name",
                    "value"
                ]
            }
        },
        "dom": {
            "type": "string",
            "description": "HTML content of the page"
        },
        "screenshot": {
            "type": [
                "string",
                "null"
            ],
            "description": "Base64 encoded PNG screenshot"
        },
        "console": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "timestamp": {
                        "type": "string"
                    }
                }
            }
        },
        "network": {
            "type": "object",
            "properties": {
                "pending": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/networkRequest"
                    }
                },
                "completed": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/networkRequest"
                    }
                }
            }
        },
        "_sanitized": {
            "type": "boolean",
            "description": "Whether PII was removed"
        },
        "_sanitizedAt": {
            "type": "string",
            "format": "date-time"
        },
        "_piiRemoved": {
            "type": "integer",
            "description": "Number of PII items redacted"
        },
        "_encrypted": {
            "type": "boolean",
            "description": "Whether file is encrypted"
        },
        "_captureMs": {
            "type": "integer",
            "description": "Capture duration in milliseconds"
        }
    },
    "definitions": {
        "networkRequest": {
            "type": "object",
            "properties": {
                "method": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                },
                "status": {
                    "type": [
                        "integer",
                        "string"
                    ]
                },
                "timestamp": {
                    "type": "string"
                }
            }
        }
    },
    "required": [
        "version",
        "timestamp",
        "url"
    ]
}